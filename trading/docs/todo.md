TODO
====

Note: This file tracks open analysis questions and design explorations. Implementation status lives in `TODO.md`.

- [x] Implement ternary controller and log ternary state fields.
- [x] Replace binary ban/can_trade with ternary permission.
- [x] Sanity check run_trader with `--max-steps` and `--all`.
- [x] Add `--max-trades` early stop to the trading loop.
- [x] Add thesis memory counter to hold positions across soft vetoes.
- [x] Document edge-gated `run_trader.py --all` sanity test outcomes in README.
- [x] Document buy-and-hold degeneracy and minimal thesis-memory extension.
- [x] Link buy-and-hold doc to related context in `TRADER_CONTEXT.md`.
- [x] Document empirical confirmation from 15s sanity run in `docs/buy_hold_degeneracy.md`.
- [x] Implement bounded thesis-depth persistence per `docs/buy_hold_degeneracy.md` (state, transitions, exits). Implemented in `step_thesis_memory` with bounded depth + cooldown; remaining work is analysis/visualization only.
- [x] Replace immediate flat-exit on desired=0 with thesis-depth decay + HOLD.
- [ ] Add CLI/config for thesis depth max (default + validation).
- [ ] Track SVO mask evolution so the GPU mask operations stay confined to the packed P/N bitplanes before the next SVO kernel revision.
- [ ] Finish the GF(3) SWAR operator set (vectorized adders/multipliers/selectors) so the “logic-limited engine” never falls back to scalar code and the M6→M9 cycle stays branchless.
- [ ] Verify `triadic_xor_bitwise` implements the branchless P/N formulas and document the `+1, -1, 0, ⊥` mapping in `signals/triadic_ops.py` so `scripts/test_ternary_logic.py` reports phase-advance behavior.
- [ ] Codify the UTES-5 Non-Archimedean NaNs (VOID, PARADOX, qMETA) in tensor metadata so the 27-state backbone always prioritizes severity (`qMETA ≺ qVOID ≺ qPARA`).
- [x] Run Phase-4.1 size training on ES once the gate reports OPEN twice; learn T/R size weights, pin H, aggregate priors, and lock the resulting schema and checksum (outputs: `logs/esnq/ES_5m/phase4_size_run.json` + `weights_size_run.json`).
- [x] Run the Phase-5 friction simulator (0.5–2.0 bps slip, 0.5 bps fee) and capture size vs marginal PnL under realistic microstructure taxes (`logs/phase5/es/phase5_execution_*.jsonl` with mean PNLS of 0.108/−0.026/−0.162/−0.297 for slip 0.5/1.0/1.5/2.0 bps).
- [x] Decide and document the BTC path for Phase-4 (higher-density ingestion, explicit non-expressible posture, or convex-only learning) so the system stops dithering (`docs/btc_phase4_path.md`).
- [x] Write a short invariants memo that declares UNKNOWN ⊥ ≠ FLAT, keeps the hazard ontology unlearned, and reiterates that the gate stays conservative; use it to guard against “make it trade” regressions (`docs/ternary_invariants.md`).
- [x] Outline the asymmetry sensors (funding/funding divergence, forced-liquidation proxies, volatility mispricing, convexity signals) needed to unlock profitable M9 regimes for this architecture (implemented the ES↔NQ influence tensor sensor in `scripts/asymmetry_influence_sensor.py` and logged `logs/asymmetry/influence_tensor_*.jsonl`).
- [x] Convert the Phase-4/Phase-5/Asymmetry plan into tracked work items with owners, deadlines, and checkpoint dates so option A→B→C execution follows the documented fork (`docs/phase4_phase5_asymmetry_plan.md` tracking table).
- [x] Resample BTC close data to 1m high-density tape via `data_downloader.py resample --freq 1min` so Phase-4 gating can revisit BTC when we have denser substrate (`data/btc/high_density/close.csv`).
- [x] Integrate the influence tensor monitor into `strategy/triadic_strategy.py` + `runner.py` so triadic permission honors sensor escalations and uses the latest `logs/asymmetry` output.
- [x] Add the Phase-6 friction exposure guard script (`scripts/phase6_exposure_control.py`) so slip >0.5 bps runs are clamped and the `docs/phase6_capital_control.md` story documents the constraint.
- [x] Extend `data_downloader.py` with Binance streaming helpers and CLI so the gate can ingest live data (`stream_binance_klines` + `python data_downloader.py stream-binance ...`). 
- [x] Document decision consumer/sink contract for `stream_actions` (delivery semantics, replay, dedupe key).
- [ ] Outline Phase-7 live density feeder design (rolling windows, memmap vs DuckDB, failure logging).
- [x] Add a read-only probe note for the stream daemon test harness (duckdb read_only for live validation).
- [x] Log thesis depth per-step and per-trade; update field list in README if new columns are added.
- [ ] Re-run full-history MSFT with thesis memory enabled; compare trade count, avg duration, and PnL.
- [ ] Aggregate thesis depth at exit (distribution and summary; confirm most exits occur near depth=0).
- [ ] Sweep thesis depth max M in {3,5,8,13} with all other params fixed.
- [x] Add a focused sanity run note or test case covering soft-veto hold behavior (recorded in `README.md`).
- [x] Log thesis depth at exit and verify most exits occur near depth=0.
- [x] Add thesis depth prev/peak to trade logs for exit diagnostics.
- [ ] Define a thesis-promotion rule (e.g., `Delta MDL_split < 0` with elevated `p_bad`).
- [ ] Build a synthetic regime-break test to validate depth promotion and non-zero exit depths.
- [x] Add a shadow-thesis tracker for depth-1 diagnostics (no execution effect).
- [x] Implement shadow-thesis logging fields (`shadow_delta_mdl`, `shadow_would_promote`).
- [x] Re-run the 15s sanity suite and summarize `shadow_delta_mdl` distribution.
- [x] Add epsilon-gated promote/tie/reject stats for shadow MDL summaries.
- [x] Upgrade shadow MDL to a refit-based split (left/right window) with a split penalty.
- [x] Define refit window size `W` and split penalty calibration (start with log(n) or small constant).
- [x] Log `shadow_is_tie` and `shadow_reject` in per-step logs.
- [x] Re-run the 15s sanity suite after refit-based shadow MDL; summarize promote/tie/reject counts.
- [x] Apply switching penalty on action-state changes (not desired state) and log action run length stats.
- [ ] Aggregate promote/tie/reject vs `p_bad`, `capital_pressure`, and `edge_t`, including PnL contribution by run length.
- [x] Add plane-rate diagnostics (logging-only): `plane_abs`, `plane_sign`, `plane_sign_flips_W`.
- [ ] Aggregate promotions vs `plane_abs`, `stress`, and joint buckets; add PnL by plane bucket and action run length.
- [x] Log `plane_sign_flips_W` and `plane_would_veto` for plane-stability diagnostics.
- [ ] Aggregate promotion/PnL vs `plane_sign_flips_W` and `plane_would_veto`.
- [ ] Aggregate mean ΔPnL vs `action_run_length`, plane sign persistence, and stress quartiles.
- [x] Build decision heatmaps from logs: `plane_abs × stress → {promotion_rate, action_rate, mean_pnl}`.
- [x] Lock heatmap binning: quantile bins (q05..q95) + under/overflow + min bin count threshold.
- [x] Add fallback to linear bins when quantile edges collapse.
- [x] Add time-series overlay plot: price + `plane_rate` + `plane_abs` with promote/action markers.
- [x] Add optional ternary simplex plot using normalized `p_bad`, `plane_abs`, `stress`.
- [x] In plotting, use `delta_plane` as signed plane-rate proxy if no signed `plane_rate` column exists.
- [x] Emit geometry plots after `run_trader.py` runs with timestamped labels under `logs/geometry/`.
- [ ] Count "would-veto" events for a prospective plane-stability rule (sign flips > 1 within `W`).
- [ ] Decide on plane-stability gate after diagnostics; implement only if supported.
- [ ] Defer `SHADOW_REFIT_WINDOW` / `SHADOW_SPLIT_PENALTY_MULT` sweeps until plane diagnostics are summarized.
- [ ] Update dashboards to display ternary state columns (permission, edge_t, capital_pressure, action_t).
- [x] Define quotient feature candidates and expected invariants (log-returns, MAD norm, W1=64/W2=256, E/C/S + deltas).
- [ ] Run a quotient-stability check: compare `Q(s_t)` drift vs `Pi(s_t)` stability on cached BTC/SPY logs.
- [x] Add a simple plotter for `q_*` fields (time series + rolling stats).
- [x] Add a quotient stability report script and capture BTC/SPY summaries.
- [ ] Capture BTC/SPY summaries from `score_quotient_stability.py`.
- [x] Decide if plot scripts should auto-timestamp `--save` outputs to enforce the no-overwrite policy.
- [ ] Verify timestamped outputs for plot scripts on a short run.
- [x] Capture the hierarchical summarisation stack and epistemic boundary in `docs/hierarchical_summarisation.md`.
- [ ] Build the minutely summariser (`tools/summarise_1s_to_1m.py`) that emits the schema described there.
- [ ] Materialize DuckDB/Parquet tables/views for `btc_1m`, `btc_15m`, `es_5m`, etc., so Phase-4/5 density and influence sensors can query summarised features.
- [ ] Wire Phase-4 density, Phase-5 friction, and Phase-6 capital logic to those summarised tables (no raw 1s ticks go directly into live gates).
- [ ] Formalize the influence tensor tables derived from summarised feature vectors and document how lag/lead dimensions are stored.
