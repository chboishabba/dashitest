# Trading TODO

Legend: (EXEC) implementation, (DECISION) policy decision, (ANALYSIS) analysis/verification, (DASHBOARD) UI/visualization.

- [x] (EXEC) Add plane counters to trading logs (plane index + per-plane activation/rates).
- [ ] (EXEC) Replace confidence thresholds with explicit ternary actions (intent/exec alignment).
- [x] (EXEC) Add losing-trade alignment script (closest profitable entry by input distance).
- [x] (EXEC) Define and log a "can trade" mask (trade eligibility separate from direction).
- [x] (EXEC) Fix `--max-trades` to count closed trades (not fills) and log `trade_closed` in per-step rows.
- [x] (DASHBOARD) Add MDL score panel to the training dashboard.
- [x] (DASHBOARD) Plot plane rates in the PG dashboard (with optional normalization/log scale).
- [x] (EXEC) Add edge_ema metric + optional cap gate.
- [x] (EXEC) Add bounded thesis memory (thesis_depth) to delay soft-veto exits.
- [x] (EXEC) Add goal/MDL config to CLI (goal cash, deadline, tax rate, MDL params).
- [ ] (DASHBOARD) Add edge_ema panel (or overlay) to the PG dashboard.
- [ ] (DASHBOARD) Plot stress histogram pane in PG dashboard.
- [x] (DASHBOARD) Guard training_dashboard_pg.py against trade-log selection (auto-select per-step log or show clear error).
- [ ] (EXEC) Implement explicit baseline simulation for regret (sell-all-at-t0 path).
- [ ] (EXEC) Add realized-volatility regime feature (continuous + ternary regime flag) and log it.
- [x] (EXEC) Harden the Phase-4 density monitor: per-ontology balance, bin persistence windows, effect-size floor, and two-check debounce before OPEN.
- [ ] (EXEC) Phase-4.1 training remains blocked on the strict Phase-4 gate (waiting for density rather than code changes); rerun `scripts/check_esnq_ingestion.py` to prove the contract each time.
- [ ] (EXEC) Ingest the ES/NQ intraday tape (proposals + prices) so the gate has something real to evaluate and the verifier sees the rows in `configs/phase4_monitor_targets.json`.
- [x] (EXEC) Author the ES/NQ intraday tape plan (data contract + loader notes) so the Phase-4 gate has a higher-density regime to monitor.
- [x] (DOC) Clarify in Phase-4 strategy notes that synthetic/amplitude-injected runs prove the monitor mechanically but do not count as legitimate OPENs, and note how to flag those runs in the gate log.
- [x] (DOC) Align M9/all-red spine write-up with PDFs (gate-first hazard, non-extractive M9, special-code severity ordering).
- [x] (DOC) Lock M5/UNKNOWN control-law and eigen-event clarifications in TRADER_CONTEXT.
- [x] (ANALYSIS) Add a lightweight guard that marks amplitude-injected Phase-4 monitor executions so they can never be confused with data-driven readiness (`--test-vector` now tags monitor logs).
- [x] (EXEC) Create the Phase-5 execution simulator (deterministic + size-dependent friction, logging realized cost) that consumes proposal logs.
- [x] (EXEC) Add decision consumers/sinks for `stream_actions` (NDJSON file, TCP fan-out, latest-action view) with at-least-once semantics.
- [x] (EXEC) Add a read-only decision probe option for the stream daemon test harness (avoid DuckDB write locks).
- [x] (EXEC) Add a combined live daemon + Binance feed runner (`scripts/stream_daemon_live.py`) for one-command testing.
- [x] (EXEC) Extend `stream_daemon_live.py` to support symbol lists or streaming all symbols with caps.
- [x] (EXEC) Add an NDJSON decision plotter (signed exposure + optional state/urgency overlays).
- [x] (EXEC) Support live-follow plotting and WebM output in `plot_stream_decisions.py`.
- [x] (EXEC) Add a budgeted decision cost gate to `stream_daemon.py` (notional fee + slippage).
- [x] (DASHBOARD) Render decision targets as step plots, add delta exposure panel, and use notional fees in the live dashboard.
- [ ] (ANALYSIS) When `posture_observe` persists in live decisions, capture the Phase-6 gate status (latest `capital_controls_*.jsonl`, allowed slip) and note whether the log is missing or unapproved.
- [ ] (ANALYSIS) Prove the live wake-up path by writing an `allowed=true` slip entry to `logs/phase6/capital_controls_*.jsonl`, restarting `scripts/stream_daemon_live.py`, and confirming `gate_open=true` plus nonzero exposure.
- [x] (EXEC) Add a Phase-6 gate snapshot to decision payloads/sinks (open flag, source log, allowed slip, reason) to make refusal observable.
- [ ] (ANALYSIS) Run the Phase-07 horizon-lift experiment: hold exposure changes for 30–120s, charge cost only on entry/exit, and recompute net/gross medians to test for slow-horizon edge.
- [ ] (ANALYSIS) Run the zero-cost sanity for the live execution log (boundary_cost_rate=0) to confirm Phase-07 flips positive when costs are removed; if it does not, debug wiring.
- [ ] (DECISION) Choose an actuation/measurement alignment: slower controller clock, batched/impulse exposure changes, or cost charged only on sign flips/regime exits (document the choice before implementing).
- [ ] (EXEC) Phase-7.1: add live decision decimation/impulse modes (e.g., `--hold-seconds {30,60,120}` and `--impulse/--deadband`) so supported events are sparse and boundary-aware.
- [ ] (EXEC) Phase-7.2: emit a live execution ledger (paper is fine) matching the Phase-07 schema (`timestamp, symbol, x_prev, x, mid, delta_mid, cost_est, realized_pnl, pred_edge`) so `phase7_status_emitter` runs unchanged.
- [ ] (ANALYSIS) Phase-7.3: build a horizon sweep harness to run a live log through Phase-07 at multiple horizons (10s/30s/60s/120s/300s) and identify any positive net density or prove absence.
- [ ] (DECISION) Phase-8 entry gate: document and enforce that Phase-07 readiness persists on live logs, actuator mode is fixed/logged, boundary gate clamps when ready=false, and one-command audit emits net/gross density, activity rate, cost vs move share, and worst drawdown per session.
- [ ] (EXEC) Phase-9 capital ledger kernel: track capital \(C_t\) with legitimacy tax \(\Lambda_t\); enforce \(\Delta x_t \le f(C_t, \text{drawdown}, \text{Phase-07})\); log capital justification per action.
- [ ] (ANALYSIS) Phase-9 eigen-regime census: certify profitability in ≥1 regime and preservation in all others; hostile regimes collapse exposure to convex-only or zero; Phase-07 negative edge must be obeyed.
- [ ] (DECISION) Phase-9 learning budget: gate learning updates on capital/variance budget; halt learning when variance rises without surplus.
- [ ] (EXEC) Phase-9 Meta-Witness: implement self-audit that can freeze learning, force OBSERVE, or require re-certification when assumptions fail or costs dominate.
- [ ] (DOC) Phase-9 justification chain: ensure every action stores regime → posture → actuator → cost model → expected surplus → realized surplus; gate future actions if a link is missing.
- [ ] (EXEC) Build Phase-7 live density feeder (rolling windows into memmap or DuckDB) so Phase-4 gates can open on live data.
- [x] (EXEC) Gate Phase-4 density monitor on Phase-07 readiness using a status log + persistence window.
- [ ] (ANALYSIS) Run Phase-07 asymmetry diagnostics (per-horizon medians, cost vs move, pred-edge scale) and capture a timestamped report.
- [ ] (ANALYSIS) Run Phase-07 wake-up tests (zero-cost and injected-drift logs) and verify Phase-07/Phase-04 readiness toggles as expected.
- [x] (DECISION) Lock quotient feature set + window (log-returns, MAD norm, W1=64/W2=256, E/C/S + deltas).
- [x] (EXEC) Implement quotient extractor in `features/quotient.py` and log `q_*` fields.
- [ ] (EXEC) Add quotient-gated ACCEPT/HOLD/BAN path to `strategy/triadic_strategy.py` (no direction control).
- [ ] (ANALYSIS) Plot `q_*` time series on cached BTC/SPY runs; confirm regime stability vs raw drift.
- [ ] (ANALYSIS) Run quotient stability report on cached BTC/SPY runs and capture summary stats.
- [x] (EXEC) Implement minimal thesis-memory state machine (direction/strength/age/cooldown/invalidation) with logging.
- [x] (EXEC) Add benchmark-regret reward option vs constant exposure (optional vol-adjusted penalty).
- [x] (ANALYSIS) Condition decision simplex on thesis state (split by thesis_d/thesis_s).
- [x] (EXEC) Split UNKNOWN vs FLAT in belief logging (distinct belief_state).
- [x] (ANALYSIS) Add simplex split by thesis_s only.
- [x] (EXEC) Log decision_kind (UNKNOWN vs FLAT vs LONG vs SHORT) without changing actions.
- [x] (EXEC) Add belief FSM shadow logging (belief_plus/belief_minus + deltas + belief_state).
- [x] (ANALYSIS) Add simplex split by belief_state (UNK/FLAT/L1/L2/S1/S2/CONFLICT).
- [x] (EXEC) Relax belief collapse rule to trigger only on beta == -1.
- [x] (EXEC) Log belief alpha per side (belief_alpha_plus/belief_alpha_minus) for antisymmetry checks.
- [x] (EXEC) Gate belief deltas by permission/beta/rho so only directional alpha moves beliefs.
- [ ] (ANALYSIS) Verify `(alpha_plus, alpha_minus)` counts from logs after a 5k tape run.
- [ ] (DECISION) Decide: decay vs hold when plane_sign == 0 (belief-plane behavior in neutral geometry).
- [ ] (EXEC) Enable plane-aware strategy selection (MDL selector over strategies), after belief-plane behavior is locked.
- [ ] (EXEC) Refactor by responsibility boundaries (keep hot loop thin):
- [x] (EXEC) Update runners to use engine.loop/trading_io.prices directly (run_all.py, run_all_two_pointO.py).
- [x] (EXEC) Extract run_trading_loop into engine/loop.py (thin hot loop remains in engine).
- [x] (EXEC) Extract price discovery/loading into trading_io/prices.py (find_btc_csv, find_stooq_csv, list_price_csvs, load_prices).
- [x] (EXEC) Extract pure helpers (norm_*, clip_ternary_sum, triadic, stress).
- [x] (EXEC) Create `signals/triadic.py` + `signals/stress.py` + `utils/stats.py`.
- [x] (EXEC) Move `clip_ternary_sum` into `ternary.py`.
- [x] (EXEC) Extract thesis FSM into policy module.
- [x] (EXEC) Isolate logging into trading_io/logs.py (emit_step_row, emit_trade_row, emit_run_summary).
- [x] (EXEC) Extract execution math (sizing, fills, fees).
- [x] (EXEC) Extract accounting (PnL, equity, drawdown) into execution/accounting.py.
- [x] (EXEC) Add `compute_step_accounting` + `build_run_summary` helpers.
